<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>OnurChatting</title>
  <script type="module">
    // Firebase importlarÄ±
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
    import { getDatabase, ref, push, onChildAdded, remove, set } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-database.js";

    // Firebase config (senin verdiÄŸin)
    const firebaseConfig = {
      apiKey: "AIzaSyDmPJMg435D2pYyepskLeX9y8BP7ECBFVU",
      authDomain: "whatsapp-2bbfe.firebaseapp.com",
      projectId: "whatsapp-2bbfe",
      storageBucket: "whatsapp-2bbfe.firebasestorage.app",
      messagingSenderId: "413471737421",
      appId: "1:413471737421:web:4e7fbc1715f969327e3e04",
      databaseURL: "https://whatsapp-2bbfe-default-rtdb.firebaseio.com/"
    };

    // BaÅŸlat
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // KullanÄ±cÄ± adÄ± iste
    let username = "";
    while(!username){
      username = prompt("KullanÄ±cÄ± adÄ±nÄ±zÄ± girin:");
    }

    // Mesajlar
    const messagesRef = ref(db,"messages");
    const statusRef   = ref(db,"status");

    // Mesaj gÃ¶nder
    window.sendMessage = function(){
      const input = document.getElementById("msgInput");
      const text = input.value.trim();
      if(text){
        push(messagesRef,{
          user: username,
          text: text,
          time: Date.now()
        });
        input.value = "";
      }
    }

    // MesajlarÄ± getir
    onChildAdded(messagesRef,(snap)=>{
      const msg = snap.val();
      const key = snap.key;
      const div = document.createElement("div");
      div.className = "message " + (msg.user === username ? "me":"other");
      div.innerHTML = `
        <div class="msgHeader">
          <b>${msg.user}</b> <span>${new Date(msg.time).toLocaleTimeString()}</span>
        </div>
        <div class="msgText">${msg.text||""}</div>
        ${msg.user===username ? 
          `<div class="msgActions">
             <button onclick="deleteForMe('${key}',this)">Bende Sil</button>
             <button onclick="deleteForAll('${key}')">Herkesten Sil</button>
           </div>`:""}
      `;
      document.getElementById("messages").appendChild(div);
      document.getElementById("messages").scrollTop = document.getElementById("messages").scrollHeight;
    });

    // Bende sil
    window.deleteForMe = function(key,btn){
      btn.closest(".message").remove();
    }

    // Herkesten sil
    window.deleteForAll = function(key){
      set(ref(db,"messages/"+key),{deleted:true});
    }

    // Mesaj silinince iÅŸaretle
    onChildAdded(messagesRef,(snap)=>{
      const key = snap.key;
      const msg = snap.val();
      if(msg.deleted){
        const msgs = document.getElementById("messages").children;
        for(let m of msgs){
          if(m.innerHTML.includes(key)){
            m.querySelector(".msgText").innerText = "ðŸš« Bu mesaj silindi";
            if(m.querySelector(".msgActions")) m.querySelector(".msgActions").remove();
          }
        }
      }
    });

    // Durum ekle
    window.addStatus = function(){
      const text = document.getElementById("statusInput").value.trim();
      if(text){
        push(statusRef,{user:username,text:text,time:Date.now()});
        document.getElementById("statusInput").value="";
      }
    }

    // DurumlarÄ± getir
    onChildAdded(statusRef,(snap)=>{
      const s = snap.val();
      const div = document.createElement("div");
      div.className="status";
      div.innerText = `${s.user}: ${s.text}`;
      document.getElementById("statusList").appendChild(div);
    });
  </script>

  <style>
    body{margin:0;font-family:sans-serif;background:#121212;color:white;display:flex;flex-direction:column;height:100vh}
    header{background:#1f1f1f;padding:10px;text-align:center;font-weight:bold;font-size:18px;color:#0ff}
    #messages{flex:1;overflow-y:auto;padding:10px}
    .message{margin:6px;padding:8px;border-radius:8px;max-width:75%;}
    .me{background:#0d7377;margin-left:auto;}
    .other{background:#323232;margin-right:auto;}
    .msgHeader{font-size:12px;color:#ccc;display:flex;justify-content:space-between}
    .msgText{margin-top:4px}
    .msgActions{margin-top:5px}
    .msgActions button{background:#ff5555;border:none;color:white;padding:3px 6px;border-radius:4px;margin-right:4px;cursor:pointer}
    footer{display:flex;padding:10px;background:#1f1f1f}
    footer input{flex:1;padding:8px;border-radius:6px;border:none}
    footer button{margin-left:8px;background:#0ff;border:none;padding:8px 12px;border-radius:6px;cursor:pointer}
    #statusArea{background:#222;padding:10px;max-height:150px;overflow:auto}
    .status{margin:4px 0;padding:4px;background:#333;border-radius:4px}
    #statusInput{width:80%;padding:6px;border:none;border-radius:6px}
    #statusBtn{background:#0ff;color:black;padding:6px;border:none;border-radius:6px;cursor:pointer;margin-left:6px}
  </style>
</head>
<body>
  <header>ðŸ’¬ OnurChatting</header>
  <div id="messages"></div>
  <footer>
    <input id="msgInput" placeholder="Mesaj yaz...">
    <button onclick="sendMessage()">GÃ¶nder</button>
  </footer>

  <div id="statusArea">
    <h3>Durumlar</h3>
    <div id="statusList"></div>
    <input id="statusInput" placeholder="Durum yaz...">
    <button id="statusBtn" onclick="addStatus()">Ekle</button>
  </div>
</body>
</html>
